/* ========================= */
/* Падающий снег ❄           */
/* ========================= */
for (let i = 0; i < 50; i++) {
    let snow = document.createElement("div");
    snow.className = "snowflake";
    snow.innerHTML = "❄";
    snow.style.left = Math.random() * 100 + "vw";
    snow.style.animationDuration = (3 + Math.random() * 5) + "s";
    snow.style.fontSize = (10 + Math.random() * 20) + "px";
    document.body.appendChild(snow);
}

/* ========================= */
/* Вопросы викторины         */
/* ========================= */
let questions = [];
let current = 0;
let points = 0;

/* 30 вопросов, по 10 на уровень сложности */
const allQuestions = {
    easy: [
        {q:"Что такое электрическое поле?", a:["Вид материи вокруг заряда","Звук","Температура","Сила трения"], c:0},
        {q:"Единица напряженности?", a:["Ньютон","Вольт","Н/Кл","Ампер"], c:2},
        {q:"Кто открыл закон Кулона?", a:["Фарадей","Кулон","Ньютон","Эйнштейн"], c:1},
        {q:"Заряд единицы положительный?", a:["Да","Нет","Зависит","Неизвестно"], c:0},
        {q:"Что измеряет кулон?", a:["Силу","Заряд","Энергию","Плотность"], c:1},
        {q:"Направление линии поля?", a:["От + к -","От - к +","Вокруг","Произвольно"], c:0},
        {q:"Сила на заряд в поле?", a:["F=qE","F=ma","F=U/I","F=mgh"], c:0},
        {q:"Единица заряда?", a:["Кулон","Вольт","Ньютон","Ампер"], c:0},
        {q:"Электрон заряд?", a:["+","-","0","Неизвестно"], c:1},
        {q:"Положительный пробный заряд?", a:["Отталкивается от +","Притягивается к +","Не движется","Всё верно"], c:0}
    ],
    medium: [
        {q:"Формула закона Кулона?", a:["F=kq1q2/r2","E=mc2","U=IR","A=Fs"], c:0},
        {q:"Потенциал измеряется в?", a:["Вольт","Ньютон","Кулон","Ом"], c:0},
        {q:"Направление поля у отрицательного заряда?", a:["К заряду","От заряда","Вбок","Вверх"], c:0},
        {q:"Электрическое поле на поверхности проводника?", a:["0","Максимальное","Зависит","Равномерное"], c:0},
        {q:"Диэлектрик увеличивает?", a:["Е","С","Q","V"], c:1},
        {q:"Сила между точечными зарядами обратно пропорциональна?", a:["r²","r","r³","r⁴"], c:0},
        {q:"Напряженность в центре сферы с равномерным зарядом?", a:["0","Макс","Мин","Зависит"], c:0},
        {q:"Кто создал теорию поля?", a:["Максвелл","Фарадей","Кулон","Ампер"], c:0},
        {q:"Линии поля параллельны?", a:["В конденсаторе","В точечном","В сферическом","Везде"], c:0},
        {q:"Работа поля?", a:["A=qEd","F=ma","P=UI","A=mc²"], c:0}
    ],
    hard: [
        {q:"Энергия точечного заряда?", a:["U=kq1q2/r","E=mc2","A=Fs","P=UI"], c:0},
        {q:"Связь E и F?", a:["E=F/q","F=E/q","E=q/F","Нет связи"], c:0},
        {q:"Линии напряженности пересекаются?", a:["Да","Нет","Иногда","Всегда"], c:1},
        {q:"Потенциал внутри проводника?", a:["Постоянный","Растет","Уменьшается","Колеблется"], c:0},
        {q:"Диэлектрик это?", a:["Проводник","Изолятор","Источник","Катушка"], c:1},
        {q:"Работа поля по замкнутому пути?", a:["0","Макс","Мин","Зависит"], c:0},
        {q:"Электростатическая индукция?", a:["Да","Нет","Иногда","Зависит"], c:0},
        {q:"Сила на диполь в однородном поле?", a:["Нет","Есть","Зависит","Произвольно"], c:0},
        {q:"Плотность потока?", a:["Φ=E*S","F=qE","U=IR","P=UI"], c:0},
        {q:"Поле точечного диполя уравнение?", a:["E~1/r³","E~1/r²","E~r","E~r²"], c:0}
    ]
};

/* ========================= */
/* Старт игры                */
/* ========================= */
function startGame(level) {
    questions = [...allQuestions[level]];
    shuffle(questions);
    document.getElementById("menu").classList.add("hidden");
    document.getElementById("quiz").classList.remove("hidden");
    current = 0;
    points = 0;
    showQuestion();
}

/* ========================= */
/* Показ вопроса             */
/* ========================= */
function showQuestion() {
    let q = questions[current];
    document.getElementById("question").innerText = q.q;
    let answersDiv = document.getElementById("answers");
    answersDiv.innerHTML = "";

    let shuffled = [...q.a];
    shuffle(shuffled);

    shuffled.forEach(ans => {
        let btn = document.createElement("button");
        btn.innerText = ans;
        btn.onclick = () => {
            if (ans === q.a[q.c]) {
                points++;
                btn.style.background = "green";
            } else {
                btn.style.background = "red";
            }
        };
        answersDiv.appendChild(btn);
    });
}

/* ========================= */
/* Следующий вопрос           */
/* ========================= */
function nextQuestion() {
    current++;
    if (current >= questions.length) {
        document.getElementById("quiz").classList.add("hidden");
        document.getElementById("result").classList.remove("hidden");
        document.getElementById("score").innerText = "Ваш результат: " + points + " из " + questions.length;
    } else {
        showQuestion();
    }
}

/* ========================= */
/* Перемешивание массива      */
/* ========================= */
function shuffle(array) {
    array.sort(() => Math.random() - 0.5);
}
